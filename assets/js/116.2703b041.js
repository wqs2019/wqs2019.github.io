(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{432:function(s,t,a){"use strict";a.r(t);var n=a(3),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"一次看懂如何解决跨域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一次看懂如何解决跨域"}},[s._v("#")]),s._v(" 一次看懂如何解决跨域")]),s._v(" "),t("blockquote",[t("p",[s._v("人生如逆旅，我亦是行人")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/common/1.gif",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_01-前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-前言"}},[s._v("#")]),s._v(" 01 前言")]),s._v(" "),t("p",[s._v("前端在调试的过程中，难免会出现跨域的问题，由于前后端分离的开发模式，前端开发部署的代码与服务器后端代码有可能不在同一个域上，不同域之间访问是会被浏览器拦截的。我们要明白一个点就是，浏览器是可以发起请求，但是结果被浏览器拦截，此谓跨域。接下来我就总结一下如何解决这一问题。")]),s._v(" "),t("h4",{attrs:{id:"跨域的原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跨域的原理"}},[s._v("#")]),s._v(" 跨域的原理")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("跨域")]),s._v("，是指浏览器不能执行其他网站的脚本。它是由浏览器的"),t("code",[s._v("同源策略")]),s._v("造成的。")]),s._v(" "),t("li",[t("code",[s._v("同源策略")]),s._v(",是浏览器对 JavaScript 实施的安全限制，只要"),t("code",[s._v("协议、域名、端口")]),s._v("有任何一个不同，都被当作是不同的域。")]),s._v(" "),t("li",[s._v("跨域原理，即是通过各种方式，避开浏览器的安全限制。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/tech/1f659d//1.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_02-跨域方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-跨域方法"}},[s._v("#")]),s._v(" 02 跨域方法")]),s._v(" "),t("p",[s._v("了解了跨域的产生情况之后，我们就可以联合客户端和服务端来进行解决。跨域解决主要有以下几种：")]),s._v(" "),t("ul",[t("li",[s._v("JSONP")]),s._v(" "),t("li",[s._v("CORS")]),s._v(" "),t("li",[s._v("Nginx代理")]),s._v(" "),t("li",[s._v("document.domain")]),s._v(" "),t("li",[s._v("window.name")]),s._v(" "),t("li",[s._v("postMessage+iframe")])]),s._v(" "),t("p",[t("strong",[s._v("1、JSONP")])]),s._v(" "),t("p",[s._v("我们知道写HTML代码的时候，加入图片链接就不会有获取不到图片的问题。这是因为图片资源并没有进行ajax请求，而且script标签是没有同源策略的，可以进行资源请求，可以说是一个前端设计的漏洞。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1.回调函数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleResponse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2.动态创建 script ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" script "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'script'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nscript"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("src "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://test.com/json?callback=handleResponse'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndocument"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("insertBefore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firstChild"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("利用script标签立即下载并执行的特性，我们就可以在回调函数中拿到返回来的数据。那么是不是所有的情况都可以呢？显然不是的。虽然实现是比较简单的操作，但是有缺点：")]),s._v(" "),t("ol",[t("li",[s._v("仅限于GET请求")]),s._v(" "),t("li",[s._v("有安全问题，万一有恶意代码返回，前端无法阻止")]),s._v(" "),t("li",[s._v("无法检测请求是否成功")])]),s._v(" "),t("p",[t("strong",[s._v("2、CORS")])]),s._v(" "),t("p",[s._v("CORS是跨域资源共享(Cross-origin resource sharing)")]),s._v(" "),t("p",[s._v("要想利用这个技术关键是在于服务端，设置返回的Access-Control-Allow-Origin响应头允许跨域操作，发送请求时有两种情况：")]),s._v(" "),t("ul",[t("li",[s._v("简单请求")]),s._v(" "),t("li",[s._v("复杂请求")])]),s._v(" "),t("p",[s._v("①简单请求")]),s._v(" "),t("p",[s._v("当使用以下方法之一：")]),s._v(" "),t("ul",[t("li",[s._v("GET")]),s._v(" "),t("li",[s._v("HEAD")]),s._v(" "),t("li",[s._v("POST")])]),s._v(" "),t("p",[s._v("Content-Type的值为以下之一：")]),s._v(" "),t("ul",[t("li",[s._v("text/plain")]),s._v(" "),t("li",[s._v("multipart/form-data")]),s._v(" "),t("li",[s._v("application/x-www-form-urlencoded")])]),s._v(" "),t("p",[s._v("才会发起简单请求，浏览器判断是简单请求的话就会在请求头添加origin字段，值是发起请求的所在的源。服务端收到请求后会判断origin是否在自己的许可范围，如果不在就拒绝，如果在就会有以下的响应头添加：")]),s._v(" "),t("ul",[t("li",[s._v("Access-Control-Allow-Origin（必选）：告诉客户端我接受请求，值为origin的值，若允许所有源请求就会返回 *。")]),s._v(" "),t("li",[s._v("Access-Control-Allow-Credentials（可选）：告诉浏览器发送请求时携带Cookie，true表示允许false表示禁止。")]),s._v(" "),t("li",[s._v("Access-Control-Expose-Headers（可选）：额外给客户端返回的头部字段。")])]),s._v(" "),t("p",[s._v("②复杂请求")]),s._v(" "),t("p",[s._v("复杂请求会有两次，第一次是发送一个预检请求，使用的方法是options，询问服务器是否允许我进行跨域请求资源。并且允许客户端自定义请求头的类型，询问服务器是否允许。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OPTIONS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cors "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Origin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nAccess"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Method"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PUT")]),s._v("\nAccess"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Request"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Headers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Custom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Header1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Custom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Header2\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" target"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nAccept"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Language"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" en"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("US")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Connection")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" keep"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alive\nUser"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Agent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Mozilla"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("然后服务器会进行验证，还会在响应头进行说明允许你的请求。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OK")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Mon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" Dec "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2008")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GMT")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Server")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Apache"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),s._v("（Unix）\nAccess"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nAccess"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Methods"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("POST")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PUT")]),s._v("\nAccess"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Allow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Headers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Custom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Header1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Custom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Header2\nAccess"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Age"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1728000")]),s._v("\nContent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" charset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\nContent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Encoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" gzip\nContent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Length"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nKeep"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Alive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("Connection")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Keep"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Alive\nContent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" text"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("plain\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ul",[t("li",[s._v("Access-Control-Allow-Origin：告诉客户端，允许你这个源的请求")]),s._v(" "),t("li",[s._v("Access-Control-Allow-Methods：告诉客户端，服务端允许的跨域 AJAX 请求的类型，也可进行 GET 或者 POST 请求")]),s._v(" "),t("li",[s._v("Access-Control-Allow-Headers：告诉客户端，服务端允许的发送请求时的自定义请求头")]),s._v(" "),t("li",[s._v("Access-Control-Max-Age: 告诉客户端预检请求的有效期，省去了多次的预检请求。也就是说，1728000 秒内你可以直接发送真正的 AJAX 请求，不用每次询问")])]),s._v(" "),t("p",[t("strong",[s._v("3、Nginx代理")])]),s._v(" "),t("p",[s._v("将nginx目录下的nginx.conf修改，通过反向代理的方式来实现跨域请求。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("所有以apis开头发起的请求会被分发到myserver\nlocation "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("apis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     proxy_pass http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("myserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" # 负载均衡名，写你请求的服务器地址\n     proxy_set_header "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("real"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip $remote_addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     proxy_set_header Host $http_host"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("4、document.domain")])]),s._v(" "),t("p",[s._v("该方式只能用于二级域名相同的情况下，比如 a.test.com 和 b.test.com 适用于该方式。")]),s._v(" "),t("p",[s._v("只需要给页面添加 document.domain = 'test.com' 表示二级域名都相同就可以实现跨域")]),s._v(" "),t("p",[t("strong",[s._v("5、window.name")])]),s._v(" "),t("p",[s._v("window.name有一个奇妙的性质，页面如果设置了window.name，那么在不关闭页面的情况下，即使进行了页面跳转location.href=...，这个window.name还是会保留。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打开必应 https://www.bing.com/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打开控制台")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("href"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://www.google.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.google.com"')]),s._v("\nNavigated to https"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex"}},[t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("www.google.com")]),t("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("strong",[s._v("6、postMessage+iframe")])]),s._v(" "),t("p",[s._v("这种方式通常用于获取嵌入页面中的第三方页面数据。一个页面发送消息，另一个页面判断来源并接收消息")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 发送消息端")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"color"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Frame Color"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"child"')]),s._v(" src"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://b.com/b.html"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nwindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onload")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frames"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("postMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'getcolor'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://b.com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 接收消息端")]),s._v("\nwindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("postMessage(data,origin)方法接受两个参数：")]),s._v(" "),t("ul",[t("li",[s._v("data:要传递的数据，html5规范中提到该参数可以是JavaScript的任意基本类型或可复制的对象，然而并不是所有浏览器都做到了这点儿，部分浏览器只能处理字符串参数，所以我们在传递参数的时候需要使用JSON.stringify()方法对对象参数序列化")]),s._v(" "),t("li",[s._v('origin：字符串参数，指明目标窗口的源，协议+主机+端口号[+URL]，URL会被忽略，所以可以不写，这个参数是为了安全考虑，postMessage()方法只会将message传递给指定窗口，当然如果愿意也可以把参数设置为"*"，这样可以传递给任意窗口，如果要指定和当前窗口同源的话设置为"/"。')])]),s._v(" "),t("h2",{attrs:{id:"_03-小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-小结"}},[s._v("#")]),s._v(" 03 小结")]),s._v(" "),t("p",[s._v("前端跨域方法其实还有很多种，但是常用的就这么一两种，个人觉得Nginx代理还很不错，配置简单还不用考虑很多事情。能够总结多种方法，遇到问题就可以考虑多一种解决方法，可能在面试中就可以多一次机会，懂得多没有什么不好，共勉。")]),s._v(" "),t("p",[t("strong",[t("font",{attrs:{color:"green"}},[s._v("参考文章")])],1),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("掘金小册前端面试之道")]),s._v(" "),t("li",[s._v("知乎《JSONP的工作原理》")]),s._v(" "),t("li",[s._v("AJAX与跨域通信")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/common/2.gif",alt:""}})])])}),[],!1,null,null,null);t.default=r.exports}}]);